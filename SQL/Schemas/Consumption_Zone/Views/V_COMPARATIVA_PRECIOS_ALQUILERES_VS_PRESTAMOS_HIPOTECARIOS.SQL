CREATE
OR REPLACE VIEW PROYECTO_JUPI.CONSUMPTION_ZONE.V_COMPARATIVA_PRECIOS_ALQUILERES_VS_PRESTAMOS_HIPOTECARIOS AS
SELECT
    DB.BARRIO,
    DTP.TIPO_DEPARTAMENTO,
    DTP.MT2_PROMEDIO,
    FPH.SUELDO_INGRESADO,
    FPH.PRECIO_PROPIEDAD_USD,
    FPH.PRECIO_PROPIEDAD_PESOS,
    FPH.MONTO_OTORGADO,
    ROUND(
        (FPH.MONTO_OTORGADO * 100) / FPH.PRECIO_PROPIEDAD_PESOS,
        2
    ) AS PORCENTAJE_PROPIEDAD_CUBIERTO,
    FPH.PRIMERA_CUOTA_PESOS,
    FPP.PRECIO_ALQUILER_PESOS,
    ROUND(
        FPH.PRIMERA_CUOTA_PESOS / FPP.PRECIO_ALQUILER_PESOS,
        2
    ) AS RATIO
FROM
    PROYECTO_JUPI.CONSUMPTION_ZONE.COZ_TBL_L2_FACT_PRESTAMOS_HIPOTECARIOS FPH
    INNER JOIN PROYECTO_JUPI.CONSUMPTION_ZONE.COZ_TBL_L2_DIM_BARRIOS DB ON FPH.ID_BARRIO = DB.ID_BARRIO
    INNER JOIN PROYECTO_JUPI.CONSUMPTION_ZONE.COZ_TBL_L2_DIM_TIPO_DEPARTAMENTO DTP ON FPH.ID_TIPO_DEPARTAMENTO = DTP.ID_TIPO_DEPARTAMENTO
    INNER JOIN PROYECTO_JUPI.CONSUMPTION_ZONE.COZ_TBL_L4_FACT_PRECIOS_PROPIEDADES FPP ON FPP.ID_BARRIO = FPH.ID_BARRIO
    AND FPP.ID_TIPO_DEPARTAMENTO = FPH.ID_TIPO_DEPARTAMENTO;