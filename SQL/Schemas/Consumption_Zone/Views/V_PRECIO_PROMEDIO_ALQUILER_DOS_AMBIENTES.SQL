CREATE OR REPLACE VIEW PROYECTO_JUPI.CONSUMPTION_ZONE.V_PRECIO_PROMEDIO_ALQUILER_DOS_AMBIENTES AS 
WITH Ordenado AS (
    SELECT 
        DB.BARRIO, 
        FPADA.PRECIO,
        ROW_NUMBER() OVER (ORDER BY FPADA.PRECIO DESC) AS rn
    FROM PROYECTO_JUPI.LANDING_ZONE.L1_FACT_PRECIO_ALQUILER_DOS_AMBIENTES FPADA
    INNER JOIN PROYECTO_JUPI.LANDING_ZONE.L1_DIM_BARRIOS DB
    ON FPADA.BARRIO = DB.BARRIO
)
SELECT ROUND(AVG(PRECIO),0) AS PRECIO_PROMEDIO
FROM Ordenado
WHERE rn > 1
ORDER BY PRECIO DESC;


SELECT * FROM PROYECTO_JUPI.CONSUMPTION_ZONE.V_PRECIO_PROMEDIO_ALQUILER_DOS_AMBIENTES;