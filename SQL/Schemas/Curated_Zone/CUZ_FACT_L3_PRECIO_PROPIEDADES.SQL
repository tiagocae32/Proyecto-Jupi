CREATE
OR REPLACE TABLE PROYECTO_JUPI.CURATED_ZONE.L3_FACT_PRECIOS_PROPIEDADES(
    ID_PRECIOS_PROPIEDADES NUMBER(38, 0) AUTOINCREMENT START 1 INCREMENT 1 PRIMARY KEY,
    ID_BARRIO NUMBER(38, 0),
    ID_TIPO_DEPARTAMENTO NUMBER(38, 0),
    PRECIO_ALQUILER_PESOS NUMBER(38, 0),
    PRECIO_COMPRA_APROXIMADO_USD NUMBER(38, 0),
    FECHA DATE
);
INSERT INTO
    PROYECTO_JUPI.CURATED_ZONE.L3_FACT_PRECIOS_PROPIEDADES(
        ID_BARRIO,
        ID_TIPO_DEPARTAMENTO,
        PRECIO_ALQUILER_PESOS,
        PRECIO_COMPRA_APROXIMADO_USD,
        FECHA
    )
SELECT
    FCMT2.ID_BARRIO,
    FPC.ID_TIPO_DEPARTAMENTO,
    FPC.PRECIO AS PRECIO_ALQUILER_PESOS,
    (FCMT2.PRECIO_USD * DTD.MT2_PROMEDIO) AS PRECIO_COMPRA_APROXIMADO_USD,
    FPC.FECHA
FROM
    PROYECTO_JUPI.CURATED_ZONE.L2_FACT_COMPRA_MT2 FCMT2
    LEFT JOIN PROYECTO_JUPI.CURATED_ZONE.L2_FACT_PRECIO_ALQUILER FPC ON FCMT2.ID_BARRIO = FPC.ID_BARRIO
    LEFT JOIN PROYECTO_JUPI.LANDING_ZONE.L1_DIM_TIPO_DEPARTAMENTO DTD ON FPC.ID_TIPO_DEPARTAMENTO = DTD.ID_TIPO_DEPARTAMENTO
WHERE
    PRECIO_COMPRA_APROXIMADO_USD IS NOT NULL
ORDER BY
    PRECIO_COMPRA_APROXIMADO_USD DESC;
SELECT
    *
FROM
    PROYECTO_JUPI.CURATED_ZONE.L3_FACT_PRECIOS_PROPIEDADES;